<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8">
<title>Rear Camera Recorder</title>
<style>
html, body {
  margin: 0;
  height: 100%;
  background: black;
  color: white;
  font-family: Arial;
  user-select: none;
}

#screen {
  position: fixed;
  inset: 0;
  background: black;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
}

#download {
  display: none;
  margin-top: 20px;
}
</style>
</head>
<body>

<div id="screen">
  <h2>ðŸ”´ Nagrywanieâ€¦</h2>
  <button id="download">â¬‡ Pobierz nagranie</button>
</div>

<script>
let recorder;
let chunks = [];
let holdTimer;
let videoBlob;

async function startRecording() {
  const stream = await navigator.mediaDevices.getUserMedia({
    video: {
      facingMode: { exact: "environment" }
    },
    audio: true
  });

  recorder = new MediaRecorder(stream, {
    mimeType: "video/webm"
  });

  recorder.ondataavailable = e => chunks.push(e.data);

  recorder.onstop = () => {
    videoBlob = new Blob(chunks, { type: "video/webm" });
    document.getElementById("download").style.display = "block";
  };

  recorder.start();
}

function stopRecording() {
  if (recorder && recorder.state !== "inactive") {
    recorder.stop();
  }
}

const screen = document.getElementById("screen");

screen.addEventListener("touchstart", () => {
  holdTimer = setTimeout(stopRecording, 2000);
});

screen.addEventListener("touchend", () => {
  clearTimeout(holdTimer);
});

document.getElementById("download").onclick = () => {
  const a = document.createElement("a");
  a.href = URL.createObjectURL(videoBlob);
  a.download = "kamera_tylna.webm";
  a.click();
};

startRecording();
</script>

</body>
</html>
